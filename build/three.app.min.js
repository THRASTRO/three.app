/* autogenerated by webmerge (compile context) */
;
/*
ThreeApp Framework (https://github.com/mgreter/three.app)
- Copyright (c) 2017 Marcel Greter (http://github.com/mgreter)
*/;
(function(c,d){function b(a,c){for(var h=a.split(/\./),l=b,e=0;e<h.length-1;e++)l[h[e]]||(l[h[e]]={}),l=l[h[e]];if(1==arguments.length)return l[h[e]];var d=typeof l[h[e]];if("object"==d){var d=l[h[e]],k;for(k in d)d.hasOwnProperty(k)&&(c[k]=d[k])}else if("undefined"!=d)throw Error("Namespace already taken!");return l[h[e]]=c}function a(){var b,c=!1,h=0,l=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(c=arguments[0],h++);for(b=arguments[h++];h<l;h++){var e=arguments[h],
d=void 0;for(d in e)Object.prototype.hasOwnProperty.call(e,d)&&(c&&"[object Object]"===Object.prototype.toString.call(e[d])?b[d]=a(!0,b[d],e[d]):c&&e[d]instanceof Array?("undefined"==typeof b[d]&&(b[d]=[]),b[d]=b[d].concat(e[d])):b[d]=e[d])}return b}d=c.THREEAPP;if("object"==typeof d)for(var e in d)d.hasOwnProperty(e)&&(b[e]=d[e]);b("extend",a);b("mixin",function(b,c){if(!c||!b)debugger;b=b.prototype;c=c.prototype;for(var h in c)c.hasOwnProperty(h)&&(c[h]instanceof Array?(b[h]||(b[h]=[]),b[h]=b[h].concat(c[h])):
c[h]instanceof Function?(b[h]=c[h],a(b[h],c[h])):c[h]instanceof Object?(b[h]||(b[h]={}),a(!0,b[h],c[h])):b[h]=c[h])});b("tmpl",function(a,b){return a.replace(/%([a-zA-Z][a-zA-Z0-9]*)%/g,function(a,c){return b[c]?b[c]:"[%"+c+"%]"})});c.THREEAPP=b})(self,THREE);
(function(c,d){function b(a,b){}function a(){for(var a={},b=this.ctor,c=0;c<b.length;c++)a[b[c]]||(b[c].apply(this,arguments),a[b[c]]=!0);b=this.init;this.__proto__.wait=t;for(c=0;c<b.length;c++)a[b[c]]||(b[c].apply(this,arguments),a[b[c]]=!0)}function e(){if(0<this.pending)return this;delete this.__proto__.wait;for(var a=0;a<this.ready.length;a++)this.ready[a].apply(this,arguments);if(this.listeners)for(var b=this.listeners.ready||[],a=0;a<b.length;a++)b[a].apply(this,arguments);delete this.pending;
this.isReady=!0;return this}function f(a,b,c){b||(b=d.Class);Array.isArray(c)||(c=[c]);if(!c)throw Error("Undefined mixin!");a.prototype.ctor||(a.prototype.ctor=[]);a.prototype.init||(a.prototype.init=[]);a.prototype.ready||(a.prototype.ready=[]);a.prototype.defaults||(a.prototype.defaults={});a.prototype.listeners||(a.prototype.listeners={});if(c&&c.length)for(var e=0,t=c.length;e<t;e++){if(!c[e])throw Error("Undefined mixin!");if(!(c[e]instanceof Function)){var f=d(c[e]);if("undefined"==typeof f)throw Error("Unknown mixin: "+
c[e]);c[e]=f}}a.prototype.listeners=d.extend(!0,{},a.prototype.listeners);for(e=0;e<c.length;e++)d.mixin(a,c[e]);d.mixin(a,b);b&&(a.prototype.__proto__=b.prototype);a.static=function(b,c){a[b]=c;return this};a.method=function(b,c){a.prototype[b]=c;return this};a.proto=function(b,c){a.prototype[b](c);return this};a.defaults=function(b){d.extend(a.prototype.defaults,b);return this};a.ctor=function(b){a.prototype.ctor.push(b);return this};a.init=function(b){a.prototype.init.push(b);return this};a.ready=
function(b){a.prototype.ready.push(b);return this};a.listen=function(b,c,e){var d=a.prototype.listeners;d[b]||(d[b]=[]);null!=e&&(c.prio=e);d[b].push(c);"ready"==b&&this.isReady&&c.call(this);return this};return a}function t(a){function b(){--d.pending;e.apply(d)}function c(a){throw a;}var d=this;d.pending++;if(!a)throw Error("Invalid wait call");if("function"==typeof a.listen)a.listen("ready",b);else if("function"==typeof a.then)a.then(b,c);else throw Error("Invalid wait promise");return e.apply(d)}
b.create=function(){var c="string"==typeof arguments[0]?[].shift.call(arguments):null,l=arguments[0]||b,t=arguments[1]||[],r=function(){this.pending=0;this.options=d.extend({},this.defaults);a.apply(this,arguments);e.apply(this,arguments)};c&&eval("Klass = "+r.toString().replace(/\(\)/,c+"()"));return f.call(b,r,l,t)};b.mixin=function(a){1>arguments.length&&(a=[]);return f.call(b,function(){throw Error("Can't instantiate mixins");},null,a)};b.virtual=function(a,c){0==arguments.length&&(a=b);if(!a)throw Error("Undefined virtual base!");
2>arguments.length&&(c=[]);return f.call(b,function(){throw Error("cannot instantiate virtual class");},a,c)};b.prototype.constructor=b;d("Class",b)})(THREE,THREEAPP);(function(c,d){c=d.Class.mixin().ctor(function(b,a){this.app=b;d.extend(this.options,a)});d("Options",c)})(THREE,THREEAPP);
(function(c,d){function b(a,b){return(b.prio||0)-(a.prio||0)}c=d.Class.mixin(["Options"]).ctor(function(a,b){this.listeners=d.extend(!0,{},this.listeners,this.options.listeners);this.deferred={}}).method("listen",function(a,c,d){"ready"==a&&this.isReady&&c.call(this);null!=d&&(c.prio=d);this.listeners.hasOwnProperty(a)||(this.listeners[a]=[]);a=this.listeners[a];-1==a.indexOf(c)&&a.push(c);a.sort(b)}).method("invoke",function(a){for(var b=Array.prototype.slice.call(arguments,1),c=this.listeners[a],
d=0,h=c?c.length:0;d<h;d++)c[d].apply(this,b);this.deferred[a]=!1}).method("trigger",function(a){var b=this;if(!b.deferred[a]){var c=Array.prototype.slice.call(arguments,1);b.deferred[a]=window.setTimeout(function(){for(var d=b.listeners[a],h=0,l=d?d.length:0;h<l;h++)d[h].apply(b,c);b.deferred[a]=!1},0)}});d("Events",c)})(THREE,THREEAPP);
(function(c,d){c=d.Class.mixin(["Events"]).method("required",[]).method("provided",{}).method("requires",function(b){Array.isArray(b)?this.required=this.required.concat(b):this.required.push(b);return this}).method("provides",function(b){var a=this.provided;Array.isArray(b)||(b=[b]);for(var c=0,d=b.length;c<d;++c){if(a.hasOwnProperty(b[c]))throw Error("Duplicate service provider");a[b[c]]=!0}return this});d("Plugin",c)})(THREE,THREEAPP);
(function(c,d){function b(a){for(var b in a)this.resources[b]=a[b]}function a(a,b){return this.assets[a]?this.assets[a][2].data:b}var e={},f=d.Class.mixin(["Options","Events"]).ctor(function(a,c){this.assets={};this.prefetch=b;a.resources=e;this.resources=jQuery.extend({},this.resources,this.options.resources);a.listen("loader.complete",function(a,b){for(var c=a.cbs.length,d=0;d<c;d++)a.cbs[d].assets[2]=a,a.cbs[d].resolve&&a.cbs[d].resolve(),a.complete=!0,a.data=b})}).init(function(a){var b=this,
d=a.manager,e=b.resources,f;for(f in e){var k=e[f][0],n=e[f][1];this.assets[f]=e[f];if(a.resources[n]){var p={obj:this,assets:e[f]};a.resources[n].complete?e[f][2]=a.resources[n]:this.wait(new Promise(function(b,c){p.reject=c;p.resolve=b;a.resources[n].cbs.push(p)}))}else{var k=k.substr(0,1).toUpperCase(),v;if("S"==k)v=new c.TextLoader(d);else if("T"==k)v=new c.TextureLoader(d);else if("I"==k)v=new c.ImageLoader(d);else if("J"==k)v=new c.JsonLoader(d);else if("A"==k)v=new c.ArrayLoader(d);else if("B"==
k)v=new c.BlobLoader(d);else if("R"==k)v=new c.BinaryLoader(d);else if("O"==k)v=new c.ObjectLoader(d);else if("L"==k)v=new c.OBJLoader(d);else throw"Unknown loader type for resource";p={obj:this,assets:e[f]};this.wait(new Promise(function(c,d){p.reject=d;p.resolve=c;a.resources[n]={total:0,loaded:0,cbs:[p]};(function(c,e,l){v.load(e,function(b){a.invoke("loader.complete",l,b)},function(c){a.invoke("loader.progress",b,l,c)},d)})(k,n,a.resources[n])}))}}}).ready(function(){this.asset=a}).listen("ready",
function(){this.options.container&&this.options.container.add(this)});d("Resources",f)})(THREE,THREEAPP);THREE.ArrayLoader=function(c){this.manager=void 0!==c?c:THREE.DefaultLoadingManager};
THREE.ArrayLoader.prototype={constructor:THREE.ArrayLoader,load:function(c,d,b,a){var e=this.manager,f=e.app,e=new THREE.FileLoader(e);c.match(/\.lzma$/)?(e.setResponseType("arraybuffer"),e.load(c,function(b){f.wlzma.decode(b).then(function(a){a=a.toUint8Array();d.call(this,a.buffer)}).catch(a)},b,a)):(e.setResponseType("arraybuffer"),e.load(c,d,b,a))}};THREE.BlobLoader=function(c){this.manager=void 0!==c?c:THREE.DefaultLoadingManager};
THREE.BlobLoader.prototype={constructor:THREE.BlobLoader,load:function(c,d,b,a){var e=this.manager,f=e.app,e=new THREE.FileLoader(e);c.match(/\.lzma$/)?(e.setResponseType("arraybuffer"),e.load(c,function(b){f.wlzma.decode(b).then(function(a){a=new Blob(a.buffers);if("object"!=typeof a)throw Error("Invalid BLOB");d.call(this,a)}).catch(a)},b,a)):(e.setResponseType("blob"),e.load(c,function(a){if(a)return d.apply(this,arguments);throw Error("Invalid BLOB");},b,a))}};
THREE.DataLoader=function(c){this.manager=void 0!==c?c:THREE.DefaultLoadingManager};
THREE.DataLoader.prototype={constructor:THREE.DataLoader,load:function(c,d,b,a){var e=this.manager,f=e.app,e=new THREE.FileLoader(e);c.match(/\.lzma$/)?(e.setResponseType("arraybuffer"),e.load(c,function(b){f.wlzma.decode(b).then(function(a){a=JSON.parse(a);if("object"!=typeof a)throw Error("Invalid JSON");d.call(this,a)}).catch(a)},b,a)):(e.setResponseType("json"),e.load(c,function(a){if(a)return d.apply(this,arguments);throw Error("Invalid JSON");},b,a))}};
THREE.JsonLoader=function(c){this.manager=void 0!==c?c:THREE.DefaultLoadingManager};
THREE.JsonLoader.prototype={constructor:THREE.JsonLoader,load:function(c,d,b,a){var e=this.manager,f=e.app,e=new THREE.FileLoader(e);c.match(/\.lzma$/)?(e.setResponseType("arraybuffer"),e.load(c,function(b){f.wlzma.decode(b).then(function(a){a=JSON.parse(a);if("object"!=typeof a)throw Error("Invalid JSON");d.call(this,a)}).catch(a)},b,a)):(e.setResponseType("json"),e.load(c,function(a){if(a)return d.apply(this,arguments);throw Error("Invalid JSON");},b,a))}};
THREE.TextLoader=function(c){this.manager=void 0!==c?c:THREE.DefaultLoadingManager};THREE.TextLoader.prototype={constructor:THREE.TextLoader,load:function(c,d,b,a){var e=this.manager.app,f=new THREE.FileLoader(this.manager);c.match(/\.lzma$/)?(f.setResponseType("arraybuffer"),f.load(c,function(b){e.wlzma.decode(b).then(function(a){a=a.toString();if("string"!=typeof a)throw Error("Invalid Text");d.call(this,a)}).catch(a)},b,a)):(f.setResponseType("text"),f.load(c,d,b,a))}};
THREE.TextureLoader=function(c){this.manager=void 0!==c?c:THREE.DefaultLoadingManager};
THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(c,d,b,a){var e=new THREE.FileLoader(this.manager),f=new THREE.Texture;e.setResponseType("arraybuffer");e.load(c,function(a){var b="application/octet-stream";c.search(/\.(jpe?g)$/)?b="image/jpeg":c.search(/\.(png)$/)?b="image/png":c.search(/\.(gif)$/)&&(b="image/gif");a=new Blob([a],{type:b});var e=new FileReader(a);f.image=document.createElementNS("http://www.w3.org/1999/xhtml","img");f.image.addEventListener("load",function(){f.format=
"image/jpeg"==b?THREE.RGBFormat:THREE.RGBAFormat;f.needsUpdate=!0;void 0!==d&&d(f)});e.addEventListener("load",function(a){f.image.src=e.result},!1);e.readAsDataURL(a)},b,a);return window.texture=f},setCrossOrigin:function(c){this.crossOrigin=c;return this},setPath:function(c){this.path=c;return this}};(function(c,d){var b=d.Class.virtual(c.Object3D).ctor(function(a,b){c.Object3D.call(this);this.sortObjects=this.matrixAutoUpdate=!0});d("Object3D",b)})(THREE,THREEAPP);
(function(){var c=THREEAPP.Class.virtual(THREE.Scene).ctor(function(c,b){THREE.Scene.call(this)});THREEAPP("Scene",c)})();
(function(c,d){c=d.Class.virtual(d.Object3D,["Events"]).ctor(function(b,a){this.lod=[]}).ready(function(b){b.lods.push(this);this.trigger("lod")}).listen("lod",function(){if(this.current!=this.level&&-1!=this.level){if(!this.lod[this.level]){var b=this.options.lod[this.level],a={},c;for(c in this.options.resources){var f=this.options.resources[c];a[c]=[f[0],d.tmpl(f[1],b)]}b=d.extend({},this.options,b,{resources:a,container:this});this.lod[this.level]=new this.options.ctor(this.app,b)}this.lod[this.level].isReady&&
(this.lod[this.current]&&this.remove(this.lod[this.current]),this.add(this.lod[this.level]),this.current=this.level)}});d("LOD",c)})(THREE,THREEAPP);
(function(c,d){var b=d.Class.create("Clock",null,["Plugin"]).proto("provides","time").proto("provides","clock").ctor(function(a){a.time=0;a.clock=new c.Clock(!1);a.clock.speed=1/3600;a.listen("clock.pause",function(){a.clock.stop();a.clock.paused=!0;a.trigger("clock.adjusted")});a.listen("clock.resume",function(){a.clock.start();a.clock.paused=!1;a.trigger("clock.adjusted")});a.listen("clock.faster",function(){a.clock.speed*=2;a.trigger("clock.adjusted")});a.listen("clock.slower",function(){a.clock.speed/=
2;a.trigger("clock.adjusted")});a.listen("clock.reverse",function(){a.clock.speed*=-1;a.trigger("clock.adjusted")});a.listen("clock.reset",function(){a.clock.speed=1/3600;a.trigger("clock.adjusted")});a.listen("preframe",function(){var b=a.clock.getDelta();a.time+=b*a.clock.speed});a.clock.setSpeed=function(b){a.clock.speed=b;a.trigger("clock.adjusted")}}).ready(function(a){a.clock.start();a.clock.paused=!1;a.trigger("clock.adjusted")});d("Plugin.Clock",b)})(THREE,THREEAPP);
(function(c,d){var b=d.Class.create("Scene",null,["Plugin"]).proto("provides","scene").ctor(function(a){a.scene=a.options.scene?new a.options.scene(a):new c.Scene(a)});d("Plugin.Scene",b)})(THREE,THREEAPP);
(function(c,d){function b(a){a.resize(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,window.window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)}c=d.Class.create("AutoSize",null,["Plugin"]).ctor(function(a){addEventListener("resize",function(){b(a)},!0);b(a)});d("Plugin.AutoSize",c)})(THREE,THREEAPP);
(function(c,d){var b=d.Class.create("WebGLRenderer",null,["Plugin"]).proto("provides","renderer").ctor(function(a){a.renderer=new c.WebGLRenderer({sortObjects:!0,antialias:!0,precision:"highp",alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!0,logarithmicDepthBuffer:!0});a.renderer.autoClear=!1;a.listen("resized",function(){a.renderer.setSize(a.width,a.height)});a.renderer.setSize(a.width,a.height);a.viewport.appendChild(a.renderer.domElement);a.listen("preframe",function(){a.renderer.clear()});
a.listen("render",function(){a.invoke("render-scene");a.renderer.render(a.scene,a.camera)})});d("Plugin.WebGLRenderer",b)})(THREE,THREEAPP);
(function(c,d){var b=d.Class.create("PerspectiveCamera",null,["Plugin"]).proto("provides","camera").ctor(function(a){a.camera=new c.PerspectiveCamera(this.options.fov||65,a.width/a.height,this.options.near||1E-6,this.options.far||1E20);a.camera.position.x=1E-11;a.listen("resized",function(){a.camera.aspect=a.width/a.height;a.camera.updateProjectionMatrix()})});d("Plugin.PerspectiveCamera",b)})(THREE,THREEAPP);
(function(c,d){var b=d.Class.create("TrackballControls",null,["Plugin"]).proto("requires","camera").proto("requires","renderer").ctor(function(a){a.controls=new c.TrackballControls(a.camera,a.renderer.domElement);a.listen("preframe",function(){a.controls.update()})});d("Plugin.TrackballControls",b)})(THREE,THREEAPP);
(function(c,d){function b(a,b){for(var c=a.cbs.length,d=0;d<c;d++)a.cbs[d].assets[2]=a,a.cbs[d].resolve&&a.cbs[d].resolve(),a.complete=!0,a.data=b}function a(){this.invoke("fetch.error",{})}function e(){1==++this.loader.completed&&this.trigger("prefetch.complete",this.loader);this.trigger("fetch.complete",this.loader)}function f(a){var b=this.loader;b.filesTotal=a[2];b.filesLoaded=a[1];this.trigger("fetch.progress",{filesTotal:b.filesTotal,filesLoaded:b.filesLoaded,bytesTotal:b.bytesTotal,bytesLoaded:b.bytesLoaded})}
function t(a,b,c){a=this.loader;0==b.total&&(b.total=c.total,a.bytesTotal+=c.total,a.filesTotal+=1);a.bytesLoaded+=c.loaded-b.loaded;b.loaded=c.loaded;this.trigger("fetch.progress",{filesTotal:a.filesTotal,filesLoaded:a.filesLoaded,bytesTotal:a.bytesTotal,bytesLoaded:a.bytesLoaded})}var h=d.Class.create("Loader",null,["Plugin"]).proto("provides","loader").ctor(function(c){c.loader=this;this.bytesLoaded=this.bytesTotal=this.filesLoaded=this.filesTotal=this.completed=0;c.listen("loader.step",f);c.listen("loader.start",
e);c.listen("loader.error",a);c.listen("loader.complete",b);c.listen("loader.progress",t)}).init(function(a){a.manager=new c.LoadingManager(function(){a.invoke("loader.start",arguments)},function(){a.invoke("loader.step",arguments)},function(){a.invoke("loader.error",arguments)});a.manager.app=a});d("Plugin.Loader",h)})(THREE,THREEAPP);
(function(c,d,b){d=b.Class.create("Progress",null,["Plugin"]).ctor(function(a){this.el=c('<div id="progressbar"/>');this.wrapper=c('<div class="indicator"/>').appendTo(this.el);this.indicator=c('<div class="bg"/>').appendTo(this.wrapper);this.text=c('<div class="text"/>').appendTo(this.el);this.el.appendTo(a.viewport);this.thresholdBytes=this.thresholdFiles=0;this.stopped=!0;this.el.hide();this.indicator.css("width","0%");var b=this;a.listen("fetch.progress",function(a){b.stopped&&(!0!==b.stopped&&
clearTimeout(b.stopped),b.el.fadeIn(200),b.stopped=!1);var c=sprintf("%d/%d (%S/%S)",a.filesLoaded,a.filesTotal,a.bytesLoaded-b.thresholdBytes,a.bytesTotal-b.thresholdBytes);b.indicator.css("width",(a.bytesLoaded-b.thresholdBytes)/(a.bytesTotal-b.thresholdBytes)*100+"%");b.text.html(c)});a.listen("fetch.complete",function(a){b.thresholdBytes=a.bytesLoaded;b.thresholdFiles=a.filesLoaded;b.stopped=setTimeout(function(){b.el.fadeOut(600,function(){b.stopped=!0})},1E3)})}).init(function(){}).ready(function(){});
b("Plugin.Progress",d)})(jQuery,THREE,THREEAPP);(function(c,d){function b(a,b,c){b||(b="f");this.uniforms[a]||(this.uniforms[a]={type:b,value:c||0});return this.uniforms[a]}c=d.Class.create("Uniforms",null,["Plugin"]).ctor(function(a){a.uniforms=[];a.uniform=b}).ready(function(a){a.hasOwnProperty("time")&&a.listen("preframe",function(){a.uniform("time").value=a.time},999999)});d("Plugin.Uniforms",c)})(THREE,THREEAPP);
(function(c,d){var b=d.Class.create("Background",null,["Plugin"]).proto("requires","renderer").proto("provides","background").ctor(function(a){a.bg=a.options.bg?new a.options.bg(a):new c.Scene(a);a.listen("render",function(){a.invoke("render-background");a.renderer.render(a.bg,a.camera)},99)});d("Plugin.Background",b)})(THREE,THREEAPP);
(function(c,d){c=d.Class.create("Tween",null,["Plugin"]).proto("provides","tween").ready(function(b){b.listen("preframe",function(){TWEEN.update()})});d("Plugin.Tween",c)})(THREE,THREEAPP);(function(c,d){c=d.Class.create("LZMA",null,["Plugin"]).proto("provides","lzma").ctor(function(b){b.wlzma=new WLZMA.Manager(2)});d("Plugin.LZMA",c)})(THREE,THREEAPP);
(function(c,d){var b=d.Class.create("LOD",d.Object3D,["Plugin"]).proto("provides","lod").proto("requires","camera").proto("requires","ui").ctor(function(a){a.lods=[]}).ready(function(a){a.listen("update-ui",function(){var b=new c.Matrix4;b.multiplyMatrices(a.camera.projectionMatrix,a.camera.matrixWorldInverse);var d=new c.Frustum;d.setFromMatrix(b);for(var b=a.camera.getWorldPosition(),t="",h=document.getElementById("lodInfo"),l=0,u=a.lods.length;l<u;l++){var r=a.lods[l].getWorldPosition(),k=b.distanceToSquared(r);
a.lods[l].inFrustum=d.intersectsSphere({center:r,radius:a.lods[l].radius||100});t+=sprintf("%02d) %.5f",l,k);if(a.lods[l].inFrustum){var k=k*Math.pow(a.camera.fov,2),r=a.lods[l].options.lod,n=0,p=r.length;if(n<p&&!r[n])debugger;for(;n<p&&k<r[n].min;)++n;n==p&&(n=-1);a.lods[l].level!=n&&(a.lods[l].level=n,a.lods[l].trigger("lod"));t+=" - lvl "+n+"<br>"}else t+=" - hidden<br>"}h&&(h.innerHTML=t)})});d("Plugin.LOD",b)})(THREE,THREEAPP);
(function(c,d){c=d.Class.create("UI",null,["Plugin"]).proto("provides","ui").ctor(function(b){var a=this;a.frames=9999;b.listen("postframe",function(){6<++a.frames&&(a.frames=0,b.trigger("update-ui"))})});d("Plugin.UI",c)})(THREE,THREEAPP);
(function(c,d){d("CPUs",function(b,a){function c(a,b){for(var d=[],e=0,h=0,t=setInterval(function(){for(var a=0;100>a;a++);},0),f=0;f<a;f++)d[f]=new Worker(l),d[f].onmessage=function(c){h+=c.data;++e==a&&(t&&clearInterval(t),b.call(this,h))};for(f=0;f<a;f++)d[f].postMessage("start")}function d(a,b){c(a,function(c){if(h>c)return b.call(this,t);if(12<a)return console.info("CPUs",a),b.call(this,a);t=a;h=c;d(2*a,b)})}var t=0,h=0;b=b.replace(/[/]*$/,"/");var l=b+"Worker.js";d(1,a)})})(THREE,THREEAPP);
onmessage=function(c){c=0;for(var d=Date.now();d+80>Date.now();){for(var b=0;200>b;b++);c++}postMessage(c);close()};
var StatsCPU=function(c){function d(a,b,c){a=document.createElement(a);a.id=b;a.style.cssText=c;return a}function b(a,b,c,e){var h=d("div",a,"padding:0 0 3px 3px;text-align:left;background:"+c),t=d("div",a+"Text","font-family:Tahoma,Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:15px;color:"+b);t.innerHTML=a.toUpperCase();h.appendChild(t);t=94/e;a=d("div",a+"Graph","width:94px;height:30px;background:"+b);h.appendChild(a);for(b=0;b<e;b++){var l=parseInt(t)==t?t+"px":100/e+"%";
a.appendChild(d("span","","width:"+l+";height:30px;float:left;opacity:0.9;background:"+c))}return h}function a(a){for(var b=m.children,c=0;c<b.length;c++)b[c].style.display=c===a?"block":"none";k=a}function e(a,b){Date.now();if(a.firstChild)for(B.style.background="rgba("+7*p+", 64, 0, 1)",b=0;b<a.children.length;b++){var d=v[b]||0;c.workers[b].idle||(d=1);a.children[b].style.height=Math.max(Math.min(30,30-30*d),.25)+"px"}}function f(a,b){a.appendChild(a.firstChild).style.height=Math.max(Math.min(30,
30-30*b),.25)+"px"}function t(){for(var a=Date.now(),b=a-K,c=0;c<app.tasker.workers.length;c++)I[c]&&(v[c]=(app.tasker.workers[c].t_busy-I[c])/b),I[c]=app.tasker.workers[c].t_busy;K=a}function h(a){var b="";1E10<=a?(a/=1E9,b="G"):1E7<=a?(a/=1E6,b="M"):1E4<=a&&(a/=1E3,b="K");a=parseInt(a);return a+b}var l=self.performance&&self.performance.now?self.performance.now.bind(performance):Date.now,u=l(),r=u,k=0,n=0,p=0;setInterval(function(){n++},20);setInterval(function(){p=Math.abs(50-n);n=0},1E3);var v=
[],m=d("div","statsCPU","width:100px;opacity:0.9;cursor:pointer");m.addEventListener("mousedown",function(b){b.preventDefault();a(++k%m.children.length)},!1);var y=0,z=0,x=b("tasks","#306","#ccc",94),G=x.children[0],H=x.children[1];m.appendChild(x);var q=0,g=0,x=b("batches","#09f","#ccc",94),C=x.children[0],J=x.children[1];m.appendChild(x);var A=0,E=0,x=b("queues","#99f","#339",94),D=x.children[0],w=x.children[1];m.appendChild(x);var B,L,F,I=[],K=0;c.listen("ready",function(){B=b("workers","#0f0",
"#020",c.threads);L=B.children[0];F=B.children[1];m.appendChild(B);a(3);for(var d=0;d<c.threads;d+=1)c.workers[d].busy=0,c.workers[d].idling=0;setInterval(t,1E3)});a(k);return{REVISION:14,domElement:m,setMode:a,begin:function(){u=l()},end:function(){var a=l();if(a>r+250){y=Math.round(1E3*c.tasks/(a-r));z=Math.max(z,y);G.textContent=h(y)+" TSK ("+h(z)+")";f(H,y/z);q=Math.round(1E3*c.batches/(a-r));g=Math.max(g,q);C.textContent=h(q)+" BAT ("+h(g)+")";f(J,q/g);A=Math.round(1E3*c.queue.length/(a-r));
E=Math.max(E,A);D.textContent=h(A)+" QUE ("+h(E)+")";f(w,A/E);if(F){e(F);var b=c.isIdle()?"":"BSY";L.textContent="CPUS "+b+" ("+c.threads+")";for(b=0;b<c.workers.length;b+=1)c.workers[b].busy=0,c.workers[b].idling=0}r=a;c.tasks=0;c.batches=0}return a},update:function(){u=this.end();e(F)}}};"object"===typeof module&&(module.exports=StatsCPU);
(function(c,d){c=d.Class.mixin(["Events","Options"]).ctor(function(b,a){this.items=[];this.length=0}).defaults({softLimit:8,hardLimit:2E3,increment:2}).method("belowSoftLimit",function(b){return this.items.length<this.options.softLimit}).method("belowHardLimit",function(b){return this.items.length<this.options.hardLimit}).method("delete",function(b){isNaN(b)&&(b=this.items.indexOf(b));if(0>b||b>this.items.length)throw"cannot remove unknown group item";var a=this.items[b];this.items.splice(b,1);--this.length;
this.trigger("decrease");this.invoke("deleted",a);this.trigger("resized")}).method("insert",function(b){if(this.belowSoftLimit())this.items.push(b),this.length+=1,this.trigger("increase");else if(this.belowHardLimit())this.items.push(b),this.options.softLimit*=this.options.increment||2,this.options.softLimit>this.options.hardLimit&&(this.options.softLimit=this.options.hardLimit),this.length+=1,this.invoke("resize");else throw Error("group reached hard limit");this.invoke("inserted",b);this.trigger("resized")});
d("Group",c)})(THREE,THREEAPP);
(function(c,d){c=d.Class.create("Grouped",null,["Events","Options"]).ctor(function(b,a){this.length=0;this.groups=[];this.current=null;this.compacting=!1}).defaults({softLimit:3,hardLimit:2E3,increment:8,compact:.75}).method("add",function(b){this.length+=1;if(this.current){if(this.current.belowHardLimit())return this.current.insert(b),this;for(var a=0;a<this.groups.length;a++)if(this.groups[a].belowHardLimit())return this.current=this.groups[a],this.current.insert(b),this}this.current=new this.options.ctor(this.app,
this.options);this.groups.push(this.current);this.current.insert(b);this.current.trigger("enable");return this}).method("delete",function(b){var a=0,c=-1;if(isNaN(b)){for(a=0;a<this.groups.length&&!(-1<(c=this.groups[a].indexOf(b)));a++);b=c}else for((0>b||b>=this.length)&&console.warn("access out of bound");a<this.groups.length&&!(b<this.groups[a].length);)b-=this.groups[a].length,a+=1;a!=this.groups.length&&(this.groups[a].delete(b),0==this.groups[a].length&&(this.groups[a].removed=!0,this.groups[a].trigger("disable"),
this.groups.splice(a,1)),--this.length,this.compacting||this.options.compact&&2<this.groups.length&&this.length/this.options.hardLimit<this.groups.length*this.options.compact&&this.compact(75))}).method("compact",function(b,a){var c=this;isNaN(a)&&(a=0);for(this.compacting=!0;a<this.groups.length;){if(this.groups[a].belowHardLimit()){for(;this.groups[a].belowHardLimit();){var d=this.groups.length-1,t=this.groups[d].length-1,h=this.groups[d].items[t];if(-1==t||d==a)break;this.groups[d].delete(t);this.groups[a].insert(h);
0==this.groups[d].length&&(this.groups[d].removed=!0,this.groups[d].trigger("disable"),this.groups.splice(d,1))}isNaN(b)||setTimeout(function(){c.compact(b,a)},b);break}a+=1}this.compacting=!1});d("Grouped",c)})(THREE,THREEAPP);
(function(c,d){function b(a,b){var c=b.buffers();if(0!=c.size){a.task=b;b.worker=a;this.load+=1;var d=[],e=[];d.push(c.size);d.push(c.cmds||0);d.push(c.args);b.invoke("updateUniforms");d.push(c.uniforms);var f=c.input,n=c.shareds,p=f?f.length:0,v=n.length;d.push(p+v);for(var m=0;m<p;m++)d.push(f[m]);for(m=0;m<v;m++)d.push(n[m]);f=c.backups;c=c.uniforms;n=f.length;for(m=0;m<n;m++)d.push(f[m]);for(m=0;m<d.length;m++)d[m]&&d[m].buffer&&e.push(d[m].buffer);for(m=0;m<c.length;m++)c[m]&&c[m].buffer&&e.push(c[m].buffer);
a.t_start=Date.now();b.invoke("calculate",a);this.invoke("calculate",b,a);a.postMessage(d,e);a.idle=!1}}function a(a){var c=this.task,d=this.parent,e=a.data[0],f=a.data[1],k=a.data[2],n=a.data[3],p=c.tbuffers;f&&!isNaN(f.length)&&(p.cmds=f);p.args=k;p.uniforms=n;f=p.input;n=p.backups;k=p.shareds;p.backups=p.results;p.results=n;f=f?f.length:0;k=k.length;for(n=0;n<f;n++)p.input[n]=a.data[5+n];for(n=0;n<k;n++)p.shareds[n]=a.data[5+f+n];for(var v=a.data.length-5-f-k,n=0;n<v;n++)p.results[n]=a.data[5+
f+k+n];--d.load;d.tasks+=e;d.batches+=1;this.task=c.worker=null;this.idle=!0;this.t_result=Date.now();this.t_busy+=this.t_result-this.t_start;0<d.queue.length&&(a=d.queue.shift(),a.queued=!1,b.call(d,this,a));d.invoke("calculated",c,this);c.invoke("calculated",this)}function e(b){if(b.data.run)this.onmessage=a;else throw Error("unexpected message");}var f=0;c=d.Class.create("Tasker",null,["Events","Options"]).ctor(function(){this.PLUGINS={};this.plugins=[];this.workers=[];this.queue=[];this.batches=
this.tasks=this.load=0}).defaults({threads:0,maxqueue:32768,taskerUrl:"Worker.js",root:"../src"}).init(function(){var a=this,b=a.options;this.wait(new Promise(function(c){0==b.threads?d.CPUs(a.path("CPUs"),function(b){a.threads=parseInt(Math.min(b/1.3,6));c()}):(a.threads=b.threads,c())}))}).ready(function(){var a=this,c=a.workers,d=this.options.taskerUrl;if(!a.started){for(var f=0;f<a.threads;f+=1)c[f]=new Worker(a.path(d)),c[f].onmessage=e,c[f].parent=a,c[f].idle=!0,c[f].id=f,c[f].t_busy=0,c[f].postMessage({plugins:a.plugins});
a.t_start=Date.now();if(0<a.queue.length&&(a=this,c=a.workers,a.isIdle()))for(f=0;f<c.length;++f)if(c[f].idle){d=a.queue.shift();b.call(a,c[f],d);d.queued=!1;break}}}).method("path",function(a){return this.options.root.replace(/\/+$/,"")+"/"+a.replace(/^\/+/,"")}).method("register",function(a){var b=this.plugins;if(this.started)throw Error("Cannot register after start");if(!a.api)throw Error("Plugin must have a task API class");a.id=b.length;var c=a.api;isNaN(c.classid)&&(c.classid=f++);a.args=c.args;
a.classid=c.classid;a.results=c.results;a.uniforms=c.uniforms;c.cmds&&(a.name=c.cmds);delete a.base;b.push(a);if(this.PLUGINS[a.name])throw Error("Plugin already exists");this.PLUGINS[a.name]=a}).method("push",function(a){if(a.queued||a.worker)throw"task already busy"+a.queued;var c=a.tasker=this,d=c.workers;if(c.isReady&&c.isIdle())for(var e=0;e<d.length;++e)if(d[e].idle){b.call(c,d[e],a);return}if(c.queue.length>=c.options.maxqueue)throw Error("Tasker queue limit exhausted");c.queue.push(a);a.queued=
!0}).method("isIdle",function(){return this.ready?this.load<this.threads:!1});d("Tasker",c)})(THREE,THREEAPP);
(function(c,d){var b=[0,0,1,0,0,1,2];c=d.Class.create("Scheduler").ctor(function(a){this.app=a;a.scheduler=this;this.tasker=a.tasker;this.batches=0;this.plan=[[],[],[]];for(a=0;3>a;a++)this.plan[a].it=0,this.plan[a].done=0,this.plan[a].onTime=0,this.plan[a].delayed=0,this.plan[a].completed=0;this.ticks=this.it=0}).defaults({}).init(function(a){this.tasker.listen("calculated",function(b,c){a.scheduler.plan[b.prio].done++;a.scheduler.tick()})}).ready(function(){}).method("frame",function(){for(var a=
this.it=this.done=0;3>a;a++)this.plan[a].done>=this.plan[a].length?(this.plan[a].done=0,this.plan[a].it=0,this.plan[a].completed++,this.plan[a].late||this.plan[a].onTime++,this.plan[a].late=!1):(this.plan[a].late=!0,this.plan[a].delayed++),this.plan[a].last=!1;this.tick()}).method("tick",function(){for(;this.tasker.isIdle()&&3>this.done;){var a=this.plan[this.it];if(a.it>=a.length)a.last||(a.last=!0,this.done+=1);else{var c=a[a.it];c.prio=this.it;this.tasker.push(c);a.it++}this.ticks=6==this.ticks?
0:this.ticks+1;this.it=b[this.ticks]}}).method("push",function(a,b){this.plan[b].push(a);this.batches+=1;this.tick()}).method("remove",function(a,b){b=this.plan[b];a=isNaN(a)?b.indexOf(a):a;0>a||(b.splice(a,1),--this.batches)});d("Scheduler",c)})(THREE,THREEAPP);
(function(c,d){c=d.Class.virtual(d.Group).ctor(function(){this.worker=null;this.queued=!1;this.tbuffers={size:0,busy:!1,stale:!0,allocated:0,results:[],backups:[],shareds:[],uniforms:[],args:[]}}).method("buffers",function(b){if(this.tbuffers.stale){b=this.items.length;var a=this.tbuffers.allocated,c=this.options.hardLimit,d=this.options.increment,t=this.api.cmds;if(0!=b){for(;b>a;)a=Math.min(c,Math.max(10,a)*d);for(var c=[],d=[],h=[],l=this.api.results||[],u=this.api.shared||[],r=0;r<l.length;r++){var k=
isNaN(l[r])?l[r].length:l[r],k=0>k?-k:k*a;c[r]=new Float32Array(k);d[r]=new Float32Array(k)}for(r=0;r<u.length;r++)k=isNaN(u[r])?u[r].length:u[r],k=0>k?-k:k,h[r]=new Float32Array(k);"string"==typeof t&&(t=this.tasker.PLUGINS[t].id);this.tbuffers={size:b,busy:!1,stale:!1,allocated:a,results:c,backups:d,shareds:h,uniforms:new Float32Array(this.api.uniforms),args:new Float32Array(this.api.args*a),cmds:isNaN(t)?new Float32Array(a):t}}this.tbuffers.stale=!1;this.invoke("syncArguments");this.tbuffers.size=
this.items.length}return this.tbuffers}).listen("calculated",function(b){b=this.tbuffers;b.stale||this.invoke("syncResults");b.tstamp=Date.now()-this.tasker.t_start}).listen("resized",function(){this.tbuffers.stale=!0});d("Batch",c)})(THREE,THREEAPP);(function(c,d){c=d.Class.create("Tasker",null,["Plugin"]).proto("provides","tasker").ctor(function(b,a){b.tasker=new d.Tasker(b,a)}).init(function(b){this.wait(b.tasker)});d("Plugin.Tasker",c)})(THREE,THREEAPP);
(function(c,d){c=d.Class.create("Scheduler",null,["Plugin"]).proto("provides","scheduler").ctor(function(b){b.scheduler=new d.Scheduler(b)}).init(function(b){b.listen("postframe",function(){b.scheduler.frame()})});d("Plugin.Scheduler",c)})(THREE,THREEAPP);
(function(c,d){c=d.Class.create("MonitorCPU",null,["Plugin"]).proto("requires","tasker").ready(function(b){var a=new StatsCPU(b.tasker);b.viewport.appendChild(a.domElement);b.listen("preframe",function(){a.begin()},-99999);b.listen("postframe",function(){a.end()},99999)});d("Plugin.MonitorCPU",c)})(THREE,THREEAPP);
(function(c,d){c=d.Class.create("DATUI",null,["Plugin"]).proto("provides","datui").ctor(function(b){b.datui=new dat.GUI}).init(function(b){b.datui.close()});d("Plugin.DATUI",c)})(THREE,THREEAPP);
var StatsGPU=function(){function c(a,b,c){a=document.createElement(a);a.id=b;a.style.cssText=c;return a}function d(a,b,d){var e=c("div",a,"padding:0 0 3px 3px;text-align:left;background:"+d),f=c("div",a+"Text","font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px;color:"+b);f.innerHTML=a.toUpperCase();e.appendChild(f);a=c("div",a+"Graph","width:94px;height:30px;background:"+b);e.appendChild(a);for(b=0;94>b;b++)a.appendChild(c("span","","width:1px;height:30px;float:left;opacity:0.9;background:"+
d));return e}function b(a){for(var b=u.children,c=0;c<b.length;c++)b[c].style.display=c===a?"block":"none";l=a}function a(a,b){a.appendChild(a.firstChild).style.height=Math.min(30,30-30*b)+"px"}var e=self.performance&&self.performance.now?self.performance.now.bind(performance):Date.now,f=e(),t=f,h=0,l=0,u=c("div","statsGPU","width:100px;opacity:0.9;cursor:pointer");u.addEventListener("mousedown",function(a){a.preventDefault();b(++l%u.children.length)},!1);var r=0,k=Infinity,n=0,p=d("fps","#0ff","#002"),
v=p.children[0],m=p.children[1];u.appendChild(p);var y=0,z=Infinity,x=0,p=d("ms","#0f0","#020"),G=p.children[0],H=p.children[1];u.appendChild(p);if(self.performance&&self.performance.memory){var q=0,g=Infinity,C=0,p=d("mb","#f08","#201"),J=p.children[0],A=p.children[1];u.appendChild(p)}b(l);return{REVISION:14,domElement:u,setMode:b,begin:function(){f=e()},end:function(){var b=e();y=b-f;z=Math.min(z,y);x=Math.max(x,y);G.textContent=(y|0)+" MS ("+(z|0)+"-"+(x|0)+")";a(H,y/200);h++;if(b>t+1E3&&(r=Math.round(1E3*
h/(b-t)),k=Math.min(k,r),n=Math.max(n,r),v.textContent=r+" FPS ("+k+"-"+n+")",a(m,r/100),t=b,h=0,void 0!==q)){var c=performance.memory.usedJSHeapSize,d=performance.memory.jsHeapSizeLimit;q=Math.round(9.54E-7*c);g=Math.min(g,q);C=Math.max(C,q);J.textContent=q+" MB ("+g+"-"+C+")";a(A,c/d)}return b},update:function(){f=this.end()}}};"object"===typeof module&&(module.exports=StatsGPU);
(function(c,d){c=d.Class.create("MonitorGPU",null,["Plugin"]).ready(function(b){var a=new StatsGPU;b.viewport.appendChild(a.domElement);b.listen("preframe",function(){a.begin()});b.listen("postframe",function(){a.end()})});d("Plugin.MonitorGPU",c)})(THREE,THREEAPP);
(function(c){function d(){var a=arguments[0],b=d.cache;b[a]&&b.hasOwnProperty(a)||(b[a]=d.parse(a));return d.format.call(null,b[a],arguments)}function b(a){return"number"===typeof a?"number":"string"===typeof a?"string":Object.prototype.toString.call(a).slice(8,-1).toLowerCase()}var a=/[^T]/,e=/[^v]/,f=/[diefg]/,t=/bcdiefguxXS/,h=/[j]/,l=/^[^\x25]+/,u=/^\x25{2}/,r=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxXSDR])/,k=/^([a-z_][a-z_\d]*)/i,n=/^\.([a-z_][a-z_\d]*)/i,
p=/^\[(\d+)\]/,v=/^[\+\-]/;d.format=function(c,k){var l=1,n=c.length,q,g,p=[],r,m,u,D=!0,w;for(r=0;r<n;r++)if(q=b(c[r]),"string"===q)p[p.length]=c[r];else if("array"===q){q=c[r];if(q[2])for(g=k[l],m=0;m<q[2].length;m++){if(!g.hasOwnProperty(q[2][m]))throw Error(d('[sprintf] property "%s" does not exist',q[2][m]));g=g[q[2][m]]}else g=q[1]?k[q[1]]:k[l++];a.test(q[8])&&e.test(q[8])&&"function"==b(g)&&(g=g());if(t.test(q[8])&&"number"!=b(g)&&isNaN(g))throw new TypeError(d("[sprintf] expecting number but found %s",
b(g)));f.test(q[8])&&(D=0<=g);switch(q[8]){case "b":g=parseInt(g,10).toString(2);break;case "c":g=String.fromCharCode(parseInt(g,10));break;case "d":case "i":g=parseInt(g,10);break;case "j":g=JSON.stringify(g,null,q[6]?parseInt(q[6]):0);break;case "e":g=q[7]?parseFloat(g).toExponential(q[7]):parseFloat(g).toExponential();break;case "f":g=q[7]?parseFloat(g).toFixed(q[7]):parseFloat(g);break;case "g":g=q[7]?parseFloat(g).toPrecision(q[7]):parseFloat(g);break;case "o":g=g.toString(8);break;case "s":g=
String(g);g=q[7]?g.substring(0,q[7]):g;break;case "t":g=String(!!g);g=q[7]?g.substring(0,q[7]):g;break;case "S":if(1024>Math.abs(g))g+=" B";else{m="KiB MiB GiB TiB PiB EiB ZiB YiB".split(" ");w=-1;do g/=1024,++w;while(1024<=Math.abs(g)&&w<m.length-1);g=g.toFixed(1)+m[w]}break;case "R":w=g/Math.PI*180;g=w%1*60;m=g%1*60;g=d("%02d\u00b0 %02d' %0.2f\"",w,g,m);break;case "D":g+=Math.PI;w=g/Math.PI*12;g=w%1*60;m=g%1*60;g=d("%02dh %02dm %0.2fs",w,g,m);break;case "T":g=b(g);g=q[7]?g.substring(0,q[7]):g;break;
case "u":g=parseInt(g,10)>>>0;break;case "v":g=g.valueOf();g=q[7]?g.substring(0,q[7]):g;break;case "x":g=parseInt(g,10).toString(16);break;case "X":g=parseInt(g,10).toString(16).toUpperCase()}h.test(q[8])?p[p.length]=g:(!f.test(q[8])||D&&!q[3]?w="":(w=D?"+":"-",g=g.toString().replace(v,"")),m=q[4]?"0"===q[4]?"0":q[4].charAt(1):" ",u=q[6]-(w+g).length,u=q[6]?0<u?0<=u&&7>=u&&y[m]?y[m][u]:Array(u+1).join(m):"":"",p[p.length]=q[5]?w+g+u:"0"===m?w+u+g:u+w+g)}return p.join("")};d.cache={};d.parse=function(a){for(var b,
c=[],d=0;a;){if(null!==(b=l.exec(a)))c[c.length]=b[0];else if(null!==(b=u.exec(a)))c[c.length]="%";else if(null!==(b=r.exec(a))){if(b[2]){var d=d|1,e=[],f=b[2],h;if(null!==(h=k.exec(f)))for(e[e.length]=h[1];""!==(f=f.substring(h[0].length));)if(null!==(h=n.exec(f)))e[e.length]=h[1];else if(null!==(h=p.exec(f)))e[e.length]=h[1];else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");b[2]=e}else d|=2;if(3===
d)throw Error("[sprintf] mixing positional and named placeholders is not (yet) supported");c[c.length]=b}else throw new SyntaxError("[sprintf] unexpected placeholder");a=a.substring(b[0].length)}return c};var m=function(a,b,c){c=(b||[]).slice(0);c.splice(0,0,a);return d.apply(null,c)},y={0:" 0 00 000 0000 00000 000000 0000000".split(" ")," ":"; ;  ;   ;    ;     ;      ;       ".split(";"),_:" _ __ ___ ____ _____ ______ _______".split(" ")};"undefined"!==typeof exports?(exports.sprintf=d,exports.vsprintf=
m):(c.sprintf=d,c.vsprintf=m,"function"===typeof define&&define.amd&&define(function(){return{sprintf:d,vsprintf:m}}))})("undefined"===typeof window?this:window);
(function(c,d,b){var a=requestAnimationFrame;c=b.Class.create("ThreeApp",null,["Events"]).ctor(function(a,c){this.frames=9999;this.viewport=a;b.extend(this.options,c)}).init(function(a,b){a=this;b=this.options;for(var c=this.options.plugins||[],d=[].concat(c),l=0;l<d.length;){var u=d[l].prototype.required;if(u&&u.length)++l;else{u=d.splice(l,1)[0];if(u.prototype.provided){for(var r=u.prototype.provided,k=0;k<d.length;k++)for(var n in r){var l=d[k].prototype.required,p=(l||[]).indexOf(n);-1!=p&&l.splice(p,
1)}l=0}r=u.name;c[k]=new u(this,b[r]);a.wait&&a.wait(c[k])}}if(d.length){for(k=0;k<d.length;k++)r=d[k].name,l=d[k].prototype.required,console.warn(r,"is missing",l);throw Error("Missing or circular dependencies");}a.plugins=c}).ready(function(){var a=this;this.options.start&&window.setTimeout(function(){a.start()},0)}).method("start",function(){var b=this;b.started||b.paused||(a(function(){b.render.call(b)}),b.started=!0)}).method("resize",function(a,b){this.width=a;this.height=b;this.invoke("resized")}).method("log",
function(){console.log(sprintf.apply(this,arguments))}).method("warn",function(){console.warn(sprintf.apply(this,arguments))}).method("info",function(){console.info(sprintf.apply(this,arguments))}).method("render",function(){var b=this;b.invoke("preframe");b.invoke("render");b.invoke("postframe");b.started&&a(function(){b.render.call(b)});++b.frames});b("App",c)})(self,THREE,THREEAPP);

/* crc: 0942BAA7A187F266C8897DBEBCE9789B */
